<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶£å‘³æ•°ä¸²é€Ÿç®— - äº’åŠ¨è¯¾ä»¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        .aspect-16-9 { aspect-ratio: 16 / 9; max-height: 90vh; }
        .slide { display: none; height: 100%; width: 100%; overflow-y: auto; padding: 40px; }
        .slide.active { display: flex; flex-direction: column; animation: fadeIn 0.5s; }
        .bg-cartoon { background: linear-gradient(180deg, #BAE6FD 0%, #E0F2FE 100%); }
        .dot { border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input[type="number"] { border-bottom: 2px solid #3B82F6; text-align: center; width: 80px; outline: none; background: transparent; }
        input[type="number"]:focus { border-color: #1D4ED8; background: #EFF6FF; }
        .block-unit { border: 2px solid; position: absolute; transition: all 0.5s ease-in-out; }
        /* è¡¨æ ¼å¾®è°ƒ */
        .tri-table td { font-size: 0.9rem; padding: 8px 4px; }
        .res-hidden { color: transparent; background: #f3f4f6; border-radius: 4px; }
        .res-show { color: #1e40af; background: transparent; font-weight: bold; animation: flipInX 0.5s; }
    </style>
</head>
<body class="bg-slate-200 flex items-center justify-center min-h-screen font-sans">

    <div id="app-container" class="w-full max-w-5xl aspect-16-9 bg-cartoon shadow-2xl rounded-3xl overflow-hidden relative border-8 border-white">
        
        <div id="slides-viewport" class="relative w-full h-full">
            
            <!-- Slide 1: å°é¢ -->
            <section class="slide active items-center justify-center text-center">
                <h1 class="text-7xl font-black text-blue-600 mb-6 animate__animated animate__backInDown">è¶£å‘³æ•°ä¸²é€Ÿç®—</h1>
                <p class="text-2xl text-blue-500 font-bold bg-white/50 py-2 px-8 rounded-full mb-8">æ•°å­¦ä¹å›­ Â· äº’åŠ¨è¯¾å ‚</p>
                <button onclick="nextSlide()" class="bg-white text-blue-600 text-3xl font-black py-4 px-12 rounded-2xl shadow-lg transform hover:scale-105 transition-all">å¼€å§‹æ¢ç´¢ ğŸš€</button>
            </section>

            <!-- Slide 2: å‘ç°ä¸‰è§’å½¢æ•° -->
            <section class="slide items-center">
                <h2 class="text-3xl font-bold text-blue-800 mb-4">å‘ç°ä¸‰è§’å½¢æ•°</h2>
                <div class="flex gap-12 items-center justify-center flex-1">
                    <div id="tri-dots-container" class="bg-white/40 p-8 rounded-3xl flex flex-col items-center gap-1 min-w-[350px]">
                        <div class="flex gap-1"><div class="dot bg-orange-500 w-6 h-6"></div></div>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl font-bold text-orange-600 mb-4">æ€»æ•°ï¼š<span id="tri-total">1</span></div>
                        <div id="tri-formula" class="text-2xl font-mono mb-6 bg-white p-4 rounded-xl border-2 border-orange-100">1</div>
                        <button onclick="addTriRow()" class="bg-green-500 text-white px-8 py-4 rounded-xl font-bold shadow-lg">+ å¢åŠ ä¸€è¡Œ</button>
                    </div>
                </div>
            </section>

            <!-- Slide 3: é€‰ 1 è¡¨æ ¼ (å±•å¼€ç®—å¼ + éšè—ç»“æœäº¤äº’) -->
            <section class="slide">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-3xl font-bold text-blue-800">é€‰ 1ï¼šè¡¥å…¨ä¸‰è§’å½¢æ•°è§„å¾‹è¡¨</h2>
                    <button onclick="revealTriResults()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-full font-bold shadow-md transition-all">ğŸ’¡ æ˜¾ç¤ºç»“æœ</button>
                </div>
                <div class="bg-white/70 rounded-2xl p-4 overflow-auto border-2 border-blue-100">
                    <table class="w-full text-center border-collapse tri-table">
                        <thead class="bg-blue-500 text-white font-bold">
                            <tr>
                                <th class="p-2 border border-blue-400 w-1/6">ä½ç½®</th>
                                <th class="p-2 border border-blue-400 w-4/6">ç®—å¼</th>
                                <th class="p-2 border border-blue-400 w-1/6">ç»“æœ</th>
                            </tr>
                        </thead>
                        <tbody id="tri-table-body">
                            <!-- JS åŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Slide 4: é€‰ 2 ç»ƒä¹  -->
            <section class="slide">
                <h2 class="text-3xl font-bold text-blue-800 mb-6">é€‰ 2ï¼šè¯·ä½ ç®—ä¸€ç®—</h2>
                <div class="space-y-4 text-xl text-nowrap">
                    <div class="bg-white/80 p-4 rounded-xl flex justify-between items-center shadow-sm">(1) 2 + 3 + 4 + 5 + 6 + 7 <div class="flex gap-2"><input type="number" id="q4_1"> <button onclick="checkAnswer('q4_1', 27)" class="bg-blue-500 text-white px-4 py-1 rounded">æ£€æŸ¥</button></div></div>
                    <div class="bg-white/80 p-4 rounded-xl flex justify-between items-center shadow-sm">(2) 1+2+3+4+5+6+7+7+7+8 <div class="flex gap-2"><input type="number" id="q4_2"> <button onclick="checkAnswer('q4_2', 47)" class="bg-blue-500 text-white px-4 py-1 rounded">æ£€æŸ¥</button></div></div>
                    <div class="bg-white/80 p-4 rounded-xl flex justify-between items-center shadow-sm">(3) 1+2+3+4+6+7+8+9+10 <div class="flex gap-2"><input type="number" id="q4_3"> <button onclick="checkAnswer('q4_3', 50)" class="bg-blue-500 text-white px-4 py-1 rounded">æ£€æŸ¥</button></div></div>
                </div>
            </section>

            <!-- Slide 5: æ•°å­¦å®éªŒå®¤ - æ­£æ–¹å½¢æ•° -->
            <section class="slide">
                <h2 class="text-3xl font-bold text-blue-800 mb-2">æ•°å­¦å®éªŒå®¤ï¼šæ‰©å»ºæ­£æ–¹å½¢</h2>
                <div class="flex flex-1 gap-8">
                    <div class="w-1/2 bg-white rounded-3xl shadow-inner flex items-center justify-center p-4 border-2 border-blue-50">
                        <div id="lab-grid" class="grid gap-1 transition-all duration-500"></div>
                    </div>
                    <div class="w-1/2 flex flex-col gap-4">
                        <div class="bg-white/80 rounded-2xl p-5 shadow-sm overflow-hidden flex-1 border border-blue-50">
                            <table class="w-full text-left text-sm">
                                <thead class="text-blue-500 border-b"><tr><th>è¾¹é•¿</th><th>æ–°å¢(å¥‡æ•°)</th><th>æ€»çƒæ•°</th></tr></thead>
                                <tbody id="lab-log"></tbody>
                            </table>
                        </div>
                        <div class="flex gap-4">
                            <button onclick="expandSquareLab()" class="flex-1 bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg">ğŸš€ æ‰©å»ºä¸€å±‚</button>
                            <button onclick="resetLab()" class="bg-gray-200 px-6 rounded-2xl">é‡ç½®</button>
                        </div>
                        <div id="lab-conclusion" class="hidden animate__animated animate__fadeInUp bg-green-100 p-4 rounded-xl border-2 border-green-400 text-green-800 italic text-center text-sm font-bold">
                            ç»“è®ºï¼š1 + 3 + 5 + ... = è¾¹é•¿ Ã— è¾¹é•¿
                        </div>
                    </div>
                </div>
            </section>

            <!-- Slide 6: é€‰ 3 -->
            <section class="slide">
                <h2 class="text-3xl font-bold text-blue-800 mb-6">é€‰ 3ï¼šæ­£æ–¹å½¢æ•°ç»ƒä¹ </h2>
                <div class="bg-white p-8 rounded-2xl space-y-8">
                    <p class="text-2xl">(1) 1 + 3 + 5 + 7 + 9 = <input type="number" id="q6_1"></p>
                    <p class="text-2xl">(2) 1 + 3 + 5 + 7 + 9 + 11 = <input type="number" id="q6_2"></p>
                    <button onclick="checkAnswer('q6_1', 25); checkAnswer('q6_2', 36);" class="bg-indigo-500 text-white px-12 py-3 rounded-xl font-bold text-xl">ä¸€é”®éªŒè¯</button>
                </div>
            </section>

            <!-- Slide 7: é‡‘å­—å¡”å˜èº«å®éªŒå®¤ -->
            <section class="slide">
                <h2 class="text-3xl font-bold text-blue-800 mb-2">é‡‘å­—å¡”å¤§å˜èº«ï¼šæ‹¼å›¾åŸç†</h2>
                <div class="flex flex-1 w-full gap-6 items-center">
                    <div class="relative bg-white rounded-3xl shadow-inner border-4 border-blue-50 flex items-center justify-center overflow-hidden" style="width: 550px; height: 450px;">
                        <div id="pyramid-lab-container" class="relative" style="width: 400px; height: 350px;"></div>
                    </div>

                    <div class="flex-1 flex flex-col gap-4">
                        <div class="bg-blue-50 p-5 rounded-2xl border-2 border-blue-100 shadow-sm">
                            <p class="text-gray-500 text-sm font-bold mb-1">ç®—å¼æ¼”ç¤ºï¼š</p>
                            <p id="pyramid-formula-text" class="text-xl font-mono text-blue-700 leading-tight h-16 flex items-center italic">1 + 2 + 1</p>
                            <div class="mt-2 flex justify-between items-end border-t pt-2">
                                <span class="text-sm text-blue-400">å¡”å°–é«˜åº¦: <b id="peak-val-display" class="text-xl">3</b></span>
                                <span id="pyramid-res-display" class="text-2xl font-black text-indigo-600">Sum: 9</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="changePeak(1)" class="bg-indigo-500 text-white py-3 rounded-xl font-bold">â• å¢åŠ </button>
                            <button onclick="changePeak(-1)" class="bg-indigo-300 text-white py-3 rounded-xl font-bold">â– å‡å°‘</button>
                        </div>
                        <button onclick="togglePyramidShape()" id="pyramid-trans-btn" class="bg-orange-500 hover:bg-orange-600 text-white py-4 rounded-2xl font-black text-xl shadow-xl transition-all">âœ¨ è½¬æ¢æˆæ­£æ–¹å½¢</button>
                        <div id="pyramid-lesson" class="hidden animate__animated animate__fadeIn bg-green-100 p-4 rounded-xl border-l-4 border-green-500 text-sm text-green-800 italic">
                            æç¤ºï¼šå³è¾¹é€’å‡éƒ¨åˆ†è¡¥åˆ°å·¦è¾¹çš„ç©ºä½ä¸Šï¼Œåˆšå¥½æ‹¼æˆä¸€ä¸ªå®Œæ•´æ­£æ–¹å½¢ã€‚
                        </div>
                    </div>
                </div>
            </section>

            <!-- Slide 8: é€‰ 4 -->
            <section class="slide">
                <h2 class="text-3xl font-bold text-blue-800 mb-4">é€‰ 4ï¼šæ•°ä¸€æ•°å¢™é¢çš„ç –</h2>
                <div class="bg-white p-10 rounded-3xl text-center shadow-lg border-2 border-blue-50">
                    <p class="text-2xl mb-4 italic font-mono">1 + 2 + 3 + 4 + 5 + 6 + 5 + 4 + 3 + 2 + 1</p>
                    <p class="text-lg text-gray-500 mb-6">æç¤ºï¼šå¡”å°–é«˜åº¦æ˜¯ 6</p>
                    <input type="number" id="q8" class="text-4xl w-40 mb-6 font-bold border-b-4">
                    <br><button onclick="checkAnswer('q8', 36)" class="bg-blue-600 text-white px-12 py-3 rounded-2xl font-bold text-xl">æ£€æŸ¥ç­”æ¡ˆ</button>
                </div>
            </section>

            <!-- Slide 9: é€‰ 5 -->
            <section class="slide">
                <h2 class="text-3xl font-bold text-blue-800 mb-6">é€‰ 5ï¼šé‡‘å­—å¡”é€Ÿç®—</h2>
                <div class="space-y-4">
                    <div class="bg-white p-4 rounded-xl flex justify-between items-center text-xl font-mono shadow-sm">(1) 1+2+...+7+7+...+1 <div class="flex gap-2"><input type="number" id="q9_1"> <button onclick="checkAnswer('q9_1', 56)" class="bg-blue-500 text-white px-4 py-1 rounded text-sm">æ£€æŸ¥</button></div></div>
                    <div class="bg-white p-4 rounded-xl flex justify-between items-center text-xl font-mono shadow-sm">(2) 1+2+...+8+8+...+1 <div class="flex gap-2"><input type="number" id="q9_2"> <button onclick="checkAnswer('q9_2', 72)" class="bg-blue-500 text-white px-4 py-1 rounded text-sm">æ£€æŸ¥</button></div></div>
                    <div class="bg-white p-4 rounded-xl flex justify-between items-center text-xl font-mono shadow-sm">(3) 1+2+...+10+7+...+1 <div class="flex gap-2"><input type="number" id="q9_3"> <button onclick="checkAnswer('q9_3', 98)" class="bg-blue-500 text-white px-4 py-1 rounded text-sm">æ£€æŸ¥</button></div></div>
                </div>
            </section>

            <!-- Slide 10: é€‰ 6 (æ‰è™«) -->
            <section class="slide items-center text-center">
                <h2 class="text-3xl font-bold text-red-600 mb-4 tracking-widest">ğŸª² é€‰ 6ï¼šæ‰è™«æ—¶åˆ»</h2>
                <div class="bg-yellow-50 border-4 border-yellow-400 p-10 rounded-3xl text-2xl font-mono relative">
                    <p id="bug-text">1 + 2 + 3 + 4 + 5 + 6 + 7 + 8 + 7 + 6 + 5 + 4 + 3 + 2 = 64</p>
                    <button onclick="fixBug()" class="mt-8 bg-red-500 text-white px-10 py-3 rounded-full text-xl shadow-lg font-bold">å‘ç°é”™è¯¯ï¼</button>
                    <p id="bug-fix" class="hidden mt-6 text-red-600 font-bold bg-white p-4 rounded-xl animate__animated animate__bounceIn border border-red-200">
                        ğŸš¨ æ‰åˆ°äº†ï¼šæœ€åæ¼æ‰äº† <span class="underline text-3xl font-black">+ 1</span>ï¼
                    </p>
                </div>
            </section>

            <!-- Slide 11: é€‰ 7 -->
            <section class="slide">
                <h2 class="text-3xl font-bold text-blue-800 mb-4">é€‰ 7ï¼šå¤æ‚æ•°ä¸²æŒ‘æˆ˜</h2>
                <div class="bg-white p-8 rounded-2xl space-y-8 text-2xl">
                    <p>(1) 3 + 4 + ... + 20 + ... + 4 + 3 = <input type="number" id="q11_1"> <button onclick="checkAnswer('q11_1', 394)" class="bg-indigo-500 text-white px-4 py-1 rounded text-sm ml-2">éªŒè¯</button></p>
                    <p>(2) 4 + 5 + ... + 30 + ... + 2 + 1 = <input type="number" id="q11_2"> <button onclick="checkAnswer('q11_2', 894)" class="bg-indigo-500 text-white px-4 py-1 rounded text-sm ml-2">éªŒè¯</button></p>
                </div>
            </section>

            <!-- Slide 12: Bç‰ˆæŒ‘æˆ˜ â‘  -->
            <section class="slide items-center justify-center">
                <div class="bg-white p-12 rounded-3xl shadow-xl text-center border-t-8 border-red-500 w-full max-w-2xl">
                    <h2 class="text-3xl font-black text-red-600 mb-6">ğŸ† Bç‰ˆæŒ‘æˆ˜ â‘ </h2>
                    <p class="text-2xl mb-8 font-mono leading-relaxed">(1+2+...+8+...+1) - (1+2+3+4+5+4+3+2+1)</p>
                    <div class="flex gap-4 justify-center items-center">
                        <input type="number" id="qb1" class="text-4xl w-48 bg-gray-50 border-2 p-2 rounded-xl text-center">
                        <button onclick="checkAnswer('qb1', 39)" class="bg-red-500 text-white px-10 py-4 rounded-xl font-bold text-xl">æäº¤</button>
                    </div>
                </div>
            </section>

            <!-- Slide 13: Bç‰ˆæŒ‘æˆ˜ â‘¡ -->
            <section class="slide items-center justify-center">
                <div class="bg-slate-800 text-white p-12 rounded-3xl text-center shadow-2xl w-full max-w-3xl border-t-8 border-yellow-500">
                    <h2 class="text-3xl font-black text-yellow-500 mb-6">ğŸ† Bç‰ˆæŒ‘æˆ˜ â‘¡</h2>
                    <p class="text-2xl font-mono mb-8 leading-relaxed">(3+4+...+10+...+3) - (1+3+5+7+9+11)</p>
                    <div class="flex gap-4 justify-center items-center">
                        <input type="number" id="qb2" class="text-4xl w-48 bg-slate-700 text-white border-yellow-400 border-2 p-2 rounded-xl text-center">
                        <button onclick="checkAnswer('qb2', 61)" class="bg-yellow-500 text-slate-900 px-10 py-4 rounded-xl font-black text-xl">æŒ‘æˆ˜</button>
                    </div>
                </div>
            </section>

            <!-- Slide 14: æ€»ç»“ -->
            <section class="slide items-center justify-center text-center">
                <h2 class="text-5xl font-black text-blue-900 mb-12">ç§˜ç±æ€»ç»“</h2>
                <div class="grid grid-cols-3 gap-8 w-full max-w-4xl font-bold">
                    <div class="bg-white p-8 rounded-3xl shadow-lg border-b-8 border-orange-400 text-orange-600">ä¸‰è§’å½¢ï¼šn(n+1)Ã·2</div>
                    <div class="bg-white p-8 rounded-3xl shadow-lg border-b-8 border-blue-400 text-blue-600">æ­£æ–¹å½¢ï¼šn Ã— n</div>
                    <div class="bg-white p-8 rounded-3xl shadow-lg border-b-8 border-green-400 text-green-600">é‡‘å­—å¡”ï¼šå¡”å°–Â²</div>
                </div>
                <button onclick="showSlide(0)" class="mt-16 text-blue-600 underline font-black text-xl">å›é¦–é¡µ</button>
            </section>

        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="absolute bottom-4 left-0 right-0 flex justify-center items-center gap-8 px-6">
            <button onclick="prevSlide()" id="prevBtn" class="bg-white/90 hover:bg-white text-blue-600 font-bold py-2 px-8 rounded-full shadow-md disabled:opacity-30">â† ä¸Šä¸€é¡µ</button>
            <div class="bg-blue-600/20 px-6 py-2 rounded-full text-blue-700 font-black"><span id="currPage">1</span> / 14</div>
            <button onclick="nextSlide()" id="nextBtn" class="bg-white/90 hover:bg-white text-blue-600 font-bold py-2 px-8 rounded-full shadow-md disabled:opacity-30">ä¸‹ä¸€é¡µ â†’</button>
        </div>

        <!-- äº¤äº’åé¦ˆ -->
        <div id="feedback" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none hidden z-50 text-9xl">âœ…</div>
    </div>

<script>
    let currentIdx = 0;
    const slides = document.getElementsByClassName('slide');

    function showSlide(idx) {
        if (idx < 0 || idx >= slides.length) return;
        for (let s of slides) s.classList.remove('active');
        slides[idx].classList.add('active');
        currentIdx = idx;
        document.getElementById('currPage').innerText = idx + 1;
        document.getElementById('prevBtn').disabled = (idx === 0);
        document.getElementById('nextBtn').disabled = (idx === slides.length - 1);
        
        // åˆ‡é¡µåˆå§‹åŒ–é€»è¾‘
        if(idx === 2) setTimeout(initTriTable, 50);
        if(idx === 4) setTimeout(resetLab, 50);
        if(idx === 6) setTimeout(renderPyramidLab, 50);
    }

    function nextSlide() { showSlide(currentIdx + 1); }
    function prevSlide() { showSlide(currentIdx - 1); }

    function checkAnswer(id, correct) {
        const input = document.getElementById(id);
        const fb = document.getElementById('feedback');
        if(parseInt(input.value) === correct) {
            fb.classList.remove('hidden'); fb.classList.add('animate__animated', 'animate__zoomIn');
            setTimeout(() => { fb.classList.add('hidden'); fb.classList.remove('animate__animated', 'animate__zoomIn'); }, 1000);
            input.classList.add('bg-green-100', 'border-green-500');
        } else {
            input.classList.add('animate__animated', 'animate__shakeX', 'border-red-500');
            setTimeout(() => input.classList.remove('animate__animated', 'animate__shakeX'), 500);
        }
    }

    // --- Slide 2 ---
    let triRows = 1;
    function addTriRow() {
        if(triRows >= 8) return;
        triRows++;
        const container = document.getElementById('tri-dots-container');
        const row = document.createElement('div');
        row.className = "flex gap-1 animate__animated animate__fadeInUp";
        for(let i=0; i<triRows; i++) row.innerHTML += '<div class="dot bg-orange-500 w-6 h-6"></div>';
        container.appendChild(row);
        document.getElementById('tri-total').innerText = (triRows*(triRows+1))/2;
        document.getElementById('tri-formula').innerText = Array.from({length:triRows}, (_,i)=>i+1).join('+');
    }

    // --- Slide 3 è¡¨æ ¼æ ¸å¿ƒé€»è¾‘ ---
    function initTriTable() {
        const body = document.getElementById('tri-table-body');
        if(!body) return;
        body.innerHTML = ""; 
        for(let i=1; i<=10; i++) {
            let formula = Array.from({ length: i }, (_, k) => k + 1).join('+');
            let result = (i * (i + 1)) / 2;
            body.innerHTML += `
                <tr class="border-b transition-all">
                    <td class="p-2 border">ç¬¬${i}ä¸ª</td>
                    <td class="p-2 border font-mono text-blue-600 text-xs">${formula}</td>
                    <td class="p-2 border"><span class="tri-res res-hidden" data-val="${result}">?</span></td>
                </tr>`;
        }
    }
    function revealTriResults() {
        const results = document.querySelectorAll('.tri-res');
        results.forEach(el => {
            el.innerText = el.getAttribute('data-val');
            el.classList.remove('res-hidden');
            el.classList.add('res-show');
        });
    }

    // --- Slide 5 å®éªŒå®¤ ---
    let labSide = 0;
    const labColors = ['#EF4444', '#3B82F6', '#10B981', '#F59E0B', '#8B5CF6'];
    function expandSquareLab() {
        if (labSide >= 7) return;
        labSide++;
        const grid = document.getElementById('lab-grid');
        grid.style.gridTemplateColumns = `repeat(${labSide}, 1fr)`;
        grid.innerHTML = '';
        for (let r = 0; r < labSide; r++) {
            for (let c = 0; c < labSide; c++) {
                const dot = document.createElement('div');
                const layer = Math.max(r, c);
                dot.className = "dot animate__animated animate__zoomIn w-7 h-7";
                dot.style.backgroundColor = (layer === labSide-1) ? labColors[(labSide-1)%5] : '#E5E7EB';
                grid.appendChild(dot);
            }
        }
        const row = document.createElement('tr');
        row.innerHTML = `<td>${labSide}</td><td class="text-orange-500">+ ${labSide===1?1:2*labSide-1}</td><td>${labSide*labSide}</td>`;
        document.getElementById('lab-log').appendChild(row);
        if(labSide>=3) document.getElementById('lab-conclusion').classList.remove('hidden');
    }
    function resetLab() {
        labSide = 0; document.getElementById('lab-grid').innerHTML = '';
        document.getElementById('lab-log').innerHTML = '';
        document.getElementById('lab-conclusion').classList.add('hidden');
    }

    // --- Slide 7 é‡‘å­—å¡” ---
    let peakH = 5; let isSquare = false; const step = 32;
    function changePeak(d) {
        let n = peakH + d; if(n < 2 || n > 7) return;
        peakH = n; isSquare = false; renderPyramidLab();
    }
    function togglePyramidShape() { isSquare = !isSquare; renderPyramidLab(); }
    function renderPyramidLab() {
        const container = document.getElementById('pyramid-lab-container');
        container.innerHTML = '';
        document.getElementById('pyramid-trans-btn').innerText = isSquare ? "è¿˜åŸæˆé‡‘å­—å¡”" : "è½¬æ¢æˆæ­£æ–¹å½¢";
        document.getElementById('pyramid-lesson').classList.toggle('hidden', !isSquare);
        const startX = (400 - (isSquare ? peakH : 2*peakH-1) * step) / 2;
        const bottomY = 320;
        let bP = []; let oP = [];
        for (let col = 1; col <= peakH; col++) {
            bP.push(col);
            for (let row = 1; row <= col; row++) createBlock(container, startX + (col-1)*step, bottomY - (row-1)*step, '#3B82F6', 'rgba(59,130,246,0.1)');
        }
        if (!isSquare) {
            for (let col = 1; col < peakH; col++) {
                let h = peakH - col; oP.push(h);
                for (let row = 1; row <= h; row++) createBlock(container, startX + (peakH+col-1)*step, bottomY - (row-1)*step, '#F97316', 'rgba(249,115,22,0.1)');
            }
            document.getElementById('pyramid-formula-text').innerText = bP.join(' + ') + ' + ' + oP.join(' + ');
        } else {
            for (let col = 1; col < peakH; col++) {
                let h = peakH - col;
                for (let row = 1; row <= h; row++) createBlock(container, startX + (col-1)*step, bottomY - (col+row-1)*step, '#F97316', 'rgba(249,115,22,0.1)');
            }
            document.getElementById('pyramid-formula-text').innerText = `${peakH} Ã— ${peakH} = ${peakH*peakH}`;
        }
        document.getElementById('peak-val-display').innerText = peakH;
        document.getElementById('pyramid-res-display').innerText = `Sum: ${peakH*peakH}`;
    }
    function createBlock(parent, x, y, color, bg) {
        const b = document.createElement('div');
        b.className = "block-unit animate__animated animate__fadeIn";
        b.style.width = '28px'; b.style.height = '28px';
        b.style.borderColor = color; b.style.backgroundColor = bg;
        b.style.left = x+'px'; b.style.top = y+'px';
        parent.appendChild(b);
    }

    function fixBug() {
        document.getElementById('bug-text').classList.add('line-through', 'text-gray-400');
        document.getElementById('bug-fix').classList.remove('hidden');
    }

    window.onload = () => showSlide(0);
</script>
</body>
</html>